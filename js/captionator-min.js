
/*
	Captionator 0.6 [CaptionPlanet]
	Christopher Giffard, 2011
	Share and enjoy

	https://github.com/cgiffard/Captionator
*/
/*global HTMLVideoElement: true, NodeList: true, Audio: true, HTMLElement: true, document:true, window:true, XMLHttpRequest:true, navigator:true, VirtualMediaContainer:true */
/*jshint strict:true */
/*Tab indented, tab = 4 spaces*/


/* Build date: Tue Mar 22 2016 19:08:01 GMT+0100 (CET) */

(function(){"use strict";var minimumFontSize=10;var minimumLineHeight=16;var fontSizeVerticalPercentage=4.5;var lineHeightRatio=1.5;var cueBackgroundColour=[0,0,0,.5];var objectsCreated=false;var captionator={};if(typeof module==="object"&&typeof module.exports==="object"){module.exports=captionator}else if(typeof define==="function"&&define.amd){define("captionator",function(){return captionator})}else{window.captionator=captionator}captionator.CaptionatorCueStructure=function CaptionatorCueStructure(cueSource,options){var cueStructureObject=this;this.isTimeDependent=false;this.cueSource=cueSource;this.options=options;this.processedCue=null;this.toString=function toString(currentTimestamp){if(options.processCueHTML!==false){var processLayer=function(layerObject,depth){if(cueStructureObject.processedCue===null){var compositeHTML="",itemIndex,cueChunk;for(itemIndex in layerObject){if(itemIndex.match(/^\d+$/)&&layerObject.hasOwnProperty(itemIndex)){cueChunk=layerObject[itemIndex];if(cueChunk instanceof Object&&cueChunk.children&&cueChunk.children.length){if(cueChunk.token==="v"){compositeHTML+='<q data-voice="'+cueChunk.voice.replace(/[\"]/g,"")+"\" class='voice "+"speaker-"+cueChunk.voice.replace(/[^a-z0-9]+/gi,"-").toLowerCase()+" webvtt-span' "+'title="'+cueChunk.voice.replace(/[\"]/g,"")+'">'+processLayer(cueChunk.children,depth+1)+"</q>"}else if(cueChunk.token==="c"){compositeHTML+="<span class='webvtt-span webvtt-class-span "+cueChunk.classes.join(" ")+"'>"+processLayer(cueChunk.children,depth+1)+"</span>"}else if(cueChunk.timeIn>0){if(currentTimestamp===null||currentTimestamp===undefined||currentTimestamp>0&&currentTimestamp>=cueChunk.timeIn){compositeHTML+="<span class='webvtt-span webvtt-timestamp-span' "+"data-timestamp='"+cueChunk.token+"' data-timestamp-seconds='"+cueChunk.timeIn+"'>"+processLayer(cueChunk.children,depth+1)+"</span>"}else if(currentTimestamp<cueChunk.timeIn){compositeHTML+="<span class='webvtt-span webvtt-timestamp-span webvtt-cue-future' aria-hidden='true' style='opacity: 0;' "+"data-timestamp='"+cueChunk.token+"' data-timestamp-seconds='"+cueChunk.timeIn+"'>"+processLayer(cueChunk.children,depth+1)+"</span>"}}else{compositeHTML+=cueChunk.rawToken+processLayer(cueChunk.children,depth+1)+"</"+cueChunk.token+">"}}else if(cueChunk instanceof String||typeof cueChunk==="string"||typeof cueChunk==="number"){compositeHTML+=cueChunk}else{}}}if(!cueStructureObject.isTimeDependent&&depth===0){cueStructureObject.processedCue=compositeHTML}return compositeHTML}else{return cueStructureObject.processedCue}};return processLayer(this,0)}else{return cueSource}};this.getPlain=function(currentTimestamp){if(options.processCueHTML!==false){var processLayer=function(layerObject,depth){var compositePlain="",itemIndex,cueChunk;for(itemIndex in layerObject){if(itemIndex.match(/^\d+$/)&&layerObject.hasOwnProperty(itemIndex)){cueChunk=layerObject[itemIndex];if(cueChunk instanceof Object&&cueChunk.children&&cueChunk.children.length){if(cueChunk.timeIn>0){if(currentTimestamp===null||currentTimestamp===undefined||currentTimestamp>0&&currentTimestamp>=cueChunk.timeIn){compositePlain+=processLayer(cueChunk.children,depth+1)}}else{compositePlain+=processLayer(cueChunk.children,depth+1)}}else if(cueChunk instanceof String||typeof cueChunk==="string"||typeof cueChunk==="number"){compositePlain+=cueChunk}}}return compositePlain};return processLayer(this,0)}else{return cueSource.replace(/<[^>]*>/gi,"")}}};captionator.CaptionatorCueStructure.prototype=[];captionator.TextTrack=function TextTrack(id,kind,label,language,trackSource,isDefault){this.onload=function(){};this.onerror=function(){};this.oncuechange=function(){};this.id=id||"";this.internalMode=captionator.TextTrack.OFF;this.cues=new captionator.TextTrackCueList(this);this.activeCues=new captionator.ActiveTextTrackCueList(this.cues,this);this.kind=kind||"subtitles";this.label=label||"";this.language=language||"";this.src=trackSource||"";this.readyState=captionator.TextTrack.NONE;this.internalDefault=isDefault||false;this.getMode=function(){return this.internalMode};this.setMode=function(value){var allowedModes=[captionator.TextTrack.OFF,captionator.TextTrack.HIDDEN,captionator.TextTrack.SHOWING],containerID,container;if(allowedModes.indexOf(value)!==-1){if(value!==this.internalMode){this.internalMode=value;if(this.readyState===captionator.TextTrack.NONE&&this.src.length>0&&value>captionator.TextTrack.OFF){this.loadTrack(this.src,null)}this.videoNode._captionator_dirtyBit=true;captionator.rebuildCaptions(this.videoNode);if(value===captionator.TextTrack.OFF){this.cues.length=0;this.readyState=captionator.TextTrack.NONE}}}else{throw new Error("Illegal mode value for track: "+value)}};this.getDefault=function(){return this.internalDefault};if(Object.prototype.__defineGetter__){this.__defineGetter__("mode",this.getMode);this.__defineSetter__("mode",this.setMode);this.__defineGetter__("default",this.getDefault)}else if(Object.defineProperty){Object.defineProperty(this,"mode",{get:this.getMode,set:this.setMode});Object.defineProperty(this,"default",{get:this.getDefault})}this.loadTrack=function(source,callback){var captionData,ajaxObject=new XMLHttpRequest;if(this.readyState===captionator.TextTrack.LOADED){if(callback instanceof Function){callback(captionData)}}else{this.src=source;this.readyState=captionator.TextTrack.LOADING;var currentTrackElement=this;ajaxObject.open("GET",source,true);ajaxObject.onreadystatechange=function(eventData){if(ajaxObject.readyState===4){if(ajaxObject.status===200){var TrackProcessingOptions=currentTrackElement.videoNode._captionatorOptions||{};if(currentTrackElement.kind==="metadata"){TrackProcessingOptions.processCueHTML=false;TrackProcessingOptions.sanitiseCueHTML=false}captionData=captionator.parseCaptions(ajaxObject.responseText,TrackProcessingOptions);currentTrackElement.readyState=captionator.TextTrack.LOADED;currentTrackElement.cues.loadCues(captionData);currentTrackElement.activeCues.refreshCues.apply(currentTrackElement.activeCues);currentTrackElement.videoNode._captionator_dirtyBit=true;captionator.rebuildCaptions(currentTrackElement.videoNode);currentTrackElement.onload.call(this);if(callback instanceof Function){callback.call(currentTrackElement,captionData)}}else{currentTrackElement.readyState=captionator.TextTrack.ERROR;currentTrackElement.onerror()}}};try{ajaxObject.send(null)}catch(Error){currentTrackElement.readyState=captionator.TextTrack.ERROR;currentTrackElement.onerror(Error)}}};this.addCue=function(cue){if(cue&&cue instanceof captionator.TextTrackCue){this.cues.addCue(cue)}else{throw new Error("The argument is null or not an instance of TextTrackCue.")}};this.removeCue=function(){}};captionator.TextTrack.NONE=0;captionator.TextTrack.LOADING=1;captionator.TextTrack.LOADED=2;captionator.TextTrack.ERROR=3;captionator.TextTrack.OFF=0;captionator.TextTrack.HIDDEN=1;captionator.TextTrack.SHOWING=2;captionator.TextTrackCue=function TextTrackCue(id,startTime,endTime,text,settings,pauseOnExit,track){this.id=id;this.track=track instanceof captionator.TextTrack?track:null;this.startTime=parseFloat(startTime);this.endTime=parseFloat(endTime)>=this.startTime?parseFloat(endTime):this.startTime;this.text=typeof text==="string"||text instanceof captionator.CaptionatorCueStructure?text:"";this.settings=typeof settings==="string"?settings:"";this.intSettings={};this.pauseOnExit=!!pauseOnExit;this.wasActive=false;this.direction="horizontal";this.snapToLines=true;this.linePosition="auto";this.textPosition=50;this.size=0;this.alignment="middle";if(this.settings.length){var intSettings=this.intSettings;var currentCue=this;settings=settings.split(/\s+/).filter(function(settingItem){return settingItem.length>0});if(settings instanceof Array){settings.forEach(function(cueItem){var settingMap={D:"direction",L:"linePosition",T:"textPosition",A:"alignment",S:"size"};cueItem=cueItem.split(":");if(settingMap[cueItem[0]]){intSettings[settingMap[cueItem[0]]]=cueItem[1]}if(settingMap[cueItem[0]]in currentCue){currentCue[settingMap[cueItem[0]]]=cueItem[1]}})}}if(this.linePosition.match(/\%/)){this.snapToLines=false}this.getCueAsSource=function getCueAsSource(){return String(this.text)};this.getCueAsHTML=function getCueAsHTML(){var DOMFragment=document.createDocumentFragment();var DOMNode=document.createElement("div");DOMNode.innerHTML=String(this.text);Array.prototype.forEach.call(DOMNode.childNodes,function(child){DOMFragment.appendChild(child.cloneNode(true))});return DOMFragment};this.isActive=function(){var currentTime=0;if(this.track instanceof captionator.TextTrack){if((this.track.mode===captionator.TextTrack.SHOWING||this.track.mode===captionator.TextTrack.HIDDEN)&&this.track.readyState===captionator.TextTrack.LOADED){try{currentTime=this.track.videoNode.currentTime;if(this.startTime<=currentTime&&this.endTime>=currentTime){if(!this.wasActive){this.wasActive=true;this.onenter()}return true}}catch(Error){return false}}}if(this.wasActive){this.wasActive=false;this.onexit()}return false};if(Object.prototype.__defineGetter__){this.__defineGetter__("active",this.isActive)}else if(Object.defineProperty){Object.defineProperty(this,"active",{get:this.isActive})}this.toString=function toString(){return"TextTrackCue:"+this.id+"\n"+String(this.text)};this.onenter=function(){};this.onexit=function(){}};captionator.TextTrackCueList=function TextTrackCueList(track){this.track=track instanceof captionator.TextTrack?track:null;this.getCueById=function(cueID){return this.filter(function(currentCue){return currentCue.id===cueID})[0]};this.loadCues=function(cueData){for(var cueIndex=0;cueIndex<cueData.length;cueIndex++){cueData[cueIndex].track=this.track;Array.prototype.push.call(this,cueData[cueIndex])}};this.addCue=function(cue){if(cue&&cue instanceof captionator.TextTrackCue){if(cue.track===this.track||!cue.track){Array.prototype.push.call(this,cue)}else{throw new Error("This cue is associated with a different track!")}}else{throw new Error("The argument is null or not an instance of TextTrackCue.")}};this.toString=function(){return"[TextTrackCueList]"}};captionator.TextTrackCueList.prototype=[];captionator.ActiveTextTrackCueList=function ActiveTextTrackCueList(textTrackCueList,textTrack){this.refreshCues=function(){if(textTrackCueList.length){var cueList=this;var cueListChanged=false;var oldCueList=[].slice.call(this,0);this.length=0;textTrackCueList.forEach(function(cue){if(cue.active){cueList.push(cue);if(cueList[cueList.length-1]!==oldCueList[cueList.length-1]){cueListChanged=true}}});if(cueListChanged){try{textTrack.oncuechange()}catch(error){}}}};this.toString=function(){return"[ActiveTextTrackCueList]"};this.refreshCues()};captionator.ActiveTextTrackCueList.prototype=new captionator.TextTrackCueList(null);var VirtualMediaContainer=function(targetObject){this.targetObject=targetObject;this.currentTime=0;var timeupdateEventHandler=function(){};this.addEventListener=function(event,handler,ignore){if(event==="timeupdate"&&handler instanceof Function){this.timeupdateEventHandler=handler}};this.attachEvent=function(event,handler){if(event==="timeupdate"&&handler instanceof Function){this.timeupdateEventHandler=handler}};this.updateTime=function(newTime){if(!isNaN(newTime)){this.currentTime=newTime;timeupdateEventHandler()}}};captionator.rebuildCaptions=function(videoElement){var trackList=videoElement.cantemoTextTracks||[];var options=videoElement._captionatorOptions instanceof Object?videoElement._captionatorOptions:{};var currentTime=videoElement.currentTime;var compositeActiveCues=[];var cuesChanged=false;var activeCueIDs=[];var cueSortArray=[];trackList.forEach(function(track,trackIndex){if(track.mode===captionator.TextTrack.SHOWING&&track.readyState===captionator.TextTrack.LOADED){cueSortArray=[].slice.call(track.activeCues,0);cueSortArray=cueSortArray.sort(function(cueA,cueB){if(cueA.startTime>cueB.startTime){return-1}else{return 1}});compositeActiveCues=compositeActiveCues.concat(cueSortArray)}});activeCueIDs=compositeActiveCues.map(function(cue){return cue.track.id+"."+cue.id+":"+cue.text.toString(currentTime).length});cuesChanged=!captionator.compareArray(activeCueIDs,videoElement._captionator_previousActiveCues);if(cuesChanged||videoElement._captionator_dirtyBit){videoElement._captionator_dirtyBit=false;videoElement._captionator_availableCueArea=null;videoElement._captionator_previousActiveCues=activeCueIDs;captionator.styleCueCanvas(videoElement);var oldNodes=[].slice.call(videoElement._descriptionContainerObject.getElementsByTagName("div"),0).concat([].slice.call(videoElement._containerObject.getElementsByTagName("div"),0));oldNodes.forEach(function(node){if(node.cueObject&&!node.cueObject.active){node.cueObject.rendered=false;node.cueObject.domNode=null;node.parentElement.removeChild(node)}});compositeActiveCues.forEach(function(cue){var cueNode,cueInner;if(cue.track.kind!=="metadata"&&cue.mode!==captionator.TextTrack.HIDDEN){if(!cue.rendered){cueNode=document.createElement("div");cueInner=document.createElement("span");cueInner.className="captionator-cue-inner";cueNode.id=String(cue.id).length?cue.id:captionator.generateID();cueNode.className="captionator-cue";cueNode.appendChild(cueInner);cueNode.cueObject=cue;cue.domNode=cueNode;cueNode.setAttribute("lang",cue.track.language);cueNode.currentText=cue.text.toString(currentTime);cueInner.innerHTML=cueNode.currentText;cue.rendered=true;if(cue.track.kind==="descriptions"){videoElement._descriptionContainerObject.appendChild(cueNode)}else{videoElement._containerObject.appendChild(cueNode)}}else{cueNode=cue.domNode;cueInner=cueNode.getElementsByClassName("captionator-cue-inner")[0];if(cue.text.toString(currentTime)!==cueNode.currentText){cueNode.currentText=cue.text.toString(currentTime);cueInner.innerHTML=cueNode.currentText;cueInner.spanified=false}}if(cue.track.kind!=="descriptions"){captionator.styleCue(cueNode,cue,videoElement)}}})}};captionator.captionify=function(element,defaultLanguage,options){var videoElements=[],elementIndex=0;options=options instanceof Object?options:{};if(options.minimumFontSize&&typeof options.minimumFontSize==="number"){minimumFontSize=options.minimumFontSize}if(options.minimumLineHeight&&typeof options.minimumLineHeight==="number"){minimumLineHeight=options.minimumLineHeight}if(options.fontSizeVerticalPercentage&&typeof options.fontSizeVerticalPercentage==="number"){fontSizeVerticalPercentage=options.fontSizeVerticalPercentage}if(options.lineHeightRatio&&typeof options.lineHeightRatio!=="number"){lineHeightRatio=options.lineHeightRatio}if(options.cueBackgroundColour&&options.cueBackgroundColour instanceof Array){cueBackgroundColour=options.cueBackgroundColour}if(!HTMLVideoElement&&!(element instanceof VirtualMediaContainer)&&!options.forceCaptionify){return false}if((typeof document.createElement("video").addCantemoTextTrack==="function"||typeof document.createElement("video").addCantemoTrack==="function")&&!options.forceCaptionify){return false}if(!objectsCreated&&options.exportObjects){window.TextTrack=captionator.TextTrack;window.TextTrackCueList=captionator.TextTrackCueList;window.ActiveTextTrackCueList=captionator.ActiveTextTrackCueList;window.TextTrackCue=captionator.TextTrackCue;objectsCreated=true}if(!element||element===false||element===undefined||element===null){videoElements=[].slice.call(document.getElementsByTagName("video"),0)}else{if(element instanceof Array){for(elementIndex=0;elementIndex<element.length;elementIndex++){if(typeof element[elementIndex]==="string"){videoElements=videoElements.concat([].slice.call(document.querySelectorAll(element[elementIndex]),0))}else if(element[elementIndex].constructor===HTMLVideoElement){videoElements.push(element[elementIndex])}}}else if(typeof element==="string"){videoElements=[].slice.call(document.querySelectorAll(element),0)}else if(element.constructor===HTMLVideoElement){videoElements.push(element)}}if(videoElements.length){videoElements.forEach(function(videoElement){videoElement.addCantemoTextTrack=function(id,kind,label,language,src,type,isDefault){var allowedKinds=["subtitles","captions","descriptions","captions","metadata","chapters"];var textKinds=allowedKinds.slice(0,7);var newTrack;id=typeof id==="string"?id:"";label=typeof label==="string"?label:"";language=typeof language==="string"?language:"";isDefault=typeof isDefault==="boolean"?isDefault:false;if(!allowedKinds.filter(function(currentKind){return kind===currentKind?true:false}).length){throw captionator.createDOMException(12,"DOMException 12: SYNTAX_ERR: You must use a valid kind when creating a TimedTextTrack.","SYNTAX_ERR")}else{newTrack=new captionator.TextTrack(id,kind,label,language,src,null);if(newTrack){if(!(videoElement.cantemoTextTracks instanceof Array)){videoElement.cantemoTextTracks=[]}videoElement.cantemoTextTracks.push(newTrack);return newTrack}else{return false}}};captionator.processVideoElement(videoElements[elementIndex],defaultLanguage,options)});return true}else{return false}};captionator.parseCaptions=function(captionData,options){options=options instanceof Object?options:{};var fileType="",subtitles=[];var cueStyles="";var cueDefaults=[];var SUBTimestampParser=/^(\d{2})?:?(\d{2}):(\d{2})\.(\d+)\,(\d{2})?:?(\d{2}):(\d{2})\.(\d+)\s*(.*)/;var SBVTimestampParser=/^(\d+)?:?(\d{2}):(\d{2})\.(\d+)\,(\d+)?:?(\d{2}):(\d{2})\.(\d+)\s*(.*)/;var SRTTimestampParser=/^(\d{2})?:?(\d{2}):(\d{2})[\.\,](\d+)\s+\-\-\>\s+(\d{2})?:?(\d{2}):(\d{2})[\.\,](\d+)\s*(.*)/;var SRTChunkTimestampParser=/(\d{2})?:?(\d{2}):(\d{2})[\.\,](\d+)/;var GoogleTimestampParser=/^([\d\.]+)\s+\+([\d\.]+)\s*(.*)/;var LRCTimestampParser=/^\[(\d{2})?:?(\d{2})\:(\d{2})\.(\d{2,3})\]\s*(.*?)$/;var WebVTTDEFAULTSCueParser=/^(DEFAULTS|DEFAULT)\s+\-\-\>\s+(.*)/g;var WebVTTSTYLECueParser=/^(STYLE|STYLES)\s+\-\-\>\s*\n([\s\S]*)/g;var WebVTTCOMMENTCueParser=/^(COMMENT|COMMENTS)\s+\-\-\>\s+(.*)/g;var TTMLCheck=/<tt\s+xml/gi;var TTMLTimestampParserAdv=/^(\d{2})?:?(\d{2}):(\d{2})\.(\d+)/;var TTMLTimestampParserHuman=/^([\d\.]+)[smhdwy]/gi;if(captionData){var processCaptionHTML=function processCaptionHTML(inputHTML){var cueStructure=new captionator.CaptionatorCueStructure(inputHTML,options),cueSplit=[],splitIndex,currentToken,currentContext,stack=[],stackIndex=0,chunkTimestamp,timeData,lastCueTime;var hasRealTextContent=function(textInput){return!!textInput.replace(/[^a-z0-9]+/gi,"").length};cueSplit=inputHTML.split(/(<\/?[^>]+>)/gi);currentContext=cueStructure;for(splitIndex in cueSplit){if(cueSplit.hasOwnProperty(splitIndex)){currentToken=cueSplit[splitIndex];if(currentToken.substr(0,1)==="<"){if(currentToken.substr(1,1)==="/"){var TagName=currentToken.substr(2).split(/[\s>]+/g)[0];if(stack.length>0){var stackScanDepth=0;for(stackIndex=stack.length-1;stackIndex>=0;stackIndex--){var parentContext=stack[stackIndex][stack[stackIndex].length-1];stackScanDepth=stackIndex;if(parentContext.token===TagName){break}}currentContext=stack[stackScanDepth];stack=stack.slice(0,stackScanDepth)}else{}}else{if(currentToken.substr(1).match(SRTChunkTimestampParser)||currentToken.match(/^<v\s+[^>]+>/i)||currentToken.match(/^<c[a-z0-9\-\_\.]+>/)||currentToken.match(/^<(b|i|u|ruby|rt)>/)||options.sanitiseCueHTML!==false){var tmpObject={token:currentToken.replace(/[<\/>]+/gi,"").split(/[\s\.]+/)[0],rawToken:currentToken,children:[]};if(tmpObject.token==="v"){tmpObject.voice=currentToken.match(/^<v\s*([^>]+)>/i)[1]}else if(tmpObject.token==="c"){tmpObject.classes=currentToken.replace(/[<\/>\s]+/gi,"").split(/[\.]+/gi).slice(1).filter(hasRealTextContent)}else if(!!(chunkTimestamp=tmpObject.rawToken.match(SRTChunkTimestampParser))){cueStructure.isTimeDependent=true;timeData=chunkTimestamp.slice(1);tmpObject.timeIn=parseInt((timeData[0]||0)*60*60,10)+parseInt((timeData[1]||0)*60,10)+parseInt(timeData[2]||0,10)+parseFloat("0."+(timeData[3]||0))}currentContext.push(tmpObject);stack.push(currentContext);currentContext=tmpObject.children}}}else{if(options.sanitiseCueHTML!==false){currentToken=currentToken.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\&/g,"&amp;");if(!options.ignoreWhitespace){currentToken=currentToken.replace(/\n+/g,"<br />")}}currentContext.push(currentToken)}}}return cueStructure};var parseCaptionChunk=function parseCaptionChunk(subtitleElement,objectCount){var subtitleParts,timeIn,timeOut,html,timeData,subtitlePartIndex,cueSettings="",id,specialCueData;var timestampMatch,tmpCue;if(specialCueData=WebVTTDEFAULTSCueParser.exec(subtitleElement)){cueDefaults=specialCueData.slice(2).join("");cueDefaults=cueDefaults.split(/\s+/g).filter(function(def){return def&&!!def.length});return null}else if(specialCueData=WebVTTSTYLECueParser.exec(subtitleElement)){cueStyles+=specialCueData[specialCueData.length-1];return null}else if(specialCueData=WebVTTCOMMENTCueParser.exec(subtitleElement)){return null}if(fileType==="LRC"){subtitleParts=[subtitleElement.substr(0,subtitleElement.indexOf("]")+1),subtitleElement.substr(subtitleElement.indexOf("]")+1)]}else{subtitleParts=subtitleElement.split(/\n/g)}while(!subtitleParts[0].replace(/\s+/gi,"").length&&subtitleParts.length>0){subtitleParts.shift()}if(subtitleParts[0].match(/^\s*[a-z0-9\-]+\s*$/gi)){id=String(subtitleParts.shift().replace(/\s*/gi,""))}else{id=objectCount}for(subtitlePartIndex=0;subtitlePartIndex<subtitleParts.length;subtitlePartIndex++){var timestamp=subtitleParts[subtitlePartIndex];if((timestampMatch=SRTTimestampParser.exec(timestamp))||(timestampMatch=SUBTimestampParser.exec(timestamp))||(timestampMatch=SBVTimestampParser.exec(timestamp))){timeData=timestampMatch.slice(1);timeIn=parseInt((timeData[0]||0)*60*60,10)+parseInt((timeData[1]||0)*60,10)+parseInt(timeData[2]||0,10)+parseFloat("0."+(timeData[3]||0));timeOut=parseInt((timeData[4]||0)*60*60,10)+parseInt((timeData[5]||0)*60,10)+parseInt(timeData[6]||0,10)+parseFloat("0."+(timeData[7]||0));if(timeData[8]){cueSettings=timeData[8]}}else if(!!(timestampMatch=GoogleTimestampParser.exec(timestamp))){timeData=timestampMatch.slice(1);timeIn=parseFloat(timeData[0]);timeOut=timeIn+parseFloat(timeData[1]);if(timeData[2]){cueSettings=timeData[2]}}else if(!!(timestampMatch=LRCTimestampParser.exec(timestamp))){timeData=timestampMatch.slice(1,timestampMatch.length-1);timeIn=parseInt((timeData[0]||0)*60*60,10)+parseInt((timeData[1]||0)*60,10)+parseInt(timeData[2]||0,10)+parseFloat("0."+(timeData[3]||0));timeOut=timeIn}subtitleParts=subtitleParts.slice(0,subtitlePartIndex).concat(subtitleParts.slice(subtitlePartIndex+1));break}if(!timeIn&&!timeOut){return null}var compositeCueSettings=cueDefaults.reduce(function(previous,current,index,array){previous[current.split(":")[0]]=current.split(":")[1];return previous},{});compositeCueSettings=cueSettings.split(/\s+/g).filter(function(set){return set&&!!set.length}).reduce(function(previous,current,index,array){previous[current.split(":")[0]]=current.split(":")[1];return previous},compositeCueSettings);cueSettings="";for(var key in compositeCueSettings){if(compositeCueSettings.hasOwnProperty(key)){cueSettings+=!!cueSettings.length?" ":"";cueSettings+=key+":"+compositeCueSettings[key]}}html=options.processCueHTML===false?subtitleParts.join("\n"):processCaptionHTML(subtitleParts.join("\n"));tmpCue=new captionator.TextTrackCue(id,timeIn,timeOut,html,cueSettings,false,null);tmpCue.styleData=cueStyles;return tmpCue};var processTTMLTimestamp=function processTTMLTimestamp(timestamp){var timeData,timeValue=0;if(typeof timestamp!=="string")return 0;if(timeData=TTMLTimestampParserAdv.exec(timestamp)){timeData=timeData.slice(1);timeValue=parseInt((timeData[0]||0)*60*60,10)+parseInt((timeData[1]||0)*60,10)+parseInt(timeData[2]||0,10)+parseFloat("0."+(timeData[3]||0))}return timeValue};var parseXMLChunk=function parseXMLChunk(xmlNode,index){var timeDataIn,timeDataOut,html,tmpCue,timeIn=0,timeOut=0;var timestampIn=String(xmlNode.getAttribute("begin"));var timestampOut=String(xmlNode.getAttribute("end"));var id=xmlNode.getAttribute("id")||index;timeIn=processTTMLTimestamp(timestampIn);timeOut=processTTMLTimestamp(timestampOut);html=options.processCueHTML===false?xmlNode.innerHTML:processCaptionHTML(xmlNode.innerHTML);return new captionator.TextTrackCue(id,timeIn,timeOut,html,{},false,null)};subtitles=captionData.replace(/\r\n/g,"\n").replace(/\r/g,"\n");if(TTMLCheck.exec(captionData)){var TTMLElement=document.createElement("ttml");TTMLElement.innerHTML=captionData;var captionElements=[].slice.call(TTMLElement.querySelectorAll("[begin],[end]"),0);var captions=captionElements.map(parseXMLChunk);return captions}else{if(captionData.split(/\n+/g).reduce(function(prev,current,index,array){return prev||!!LRCTimestampParser.exec(current)},false)){subtitles=subtitles.split(/\n+/g);fileType="LRC"}else{subtitles=subtitles.split(/\n\n+/g)}subtitles=subtitles.filter(function(lineGroup){if(lineGroup.match(/^WEBVTT(\s*FILE)?/gi)){fileType="WebVTT";return false}else{if(lineGroup.replace(/\s*/gi,"").length){return true}return false}}).map(parseCaptionChunk).filter(function(cue){if(cue!==null){return true}return false});if(fileType==="LRC"){subtitles.forEach(function(cue,index){var thisCueStartTime=0,lastCue;if(index>0){thisCueStartTime=cue.startTime;lastCue=subtitles[--index];if(lastCue.endTime<thisCueStartTime){lastCue.endTime=thisCueStartTime}}});subtitles=subtitles.filter(function(cue){if(cue.text.toString().replace(/\s*/,"").length>0){return true}return false})}return subtitles}return[]}else{throw new Error("Required parameter captionData not supplied.")}};captionator.processVideoElement=function(videoElement,defaultLanguage,options){var trackList=[];var language=navigator.language||navigator.userLanguage;var globalLanguage=defaultLanguage||language.split("-")[0];options=options instanceof Object?options:{};if(!videoElement.captioned){videoElement._captionatorOptions=options;videoElement.className+=(videoElement.className.length?" ":"")+"captioned";videoElement.captioned=true;if(videoElement.id.length===0){videoElement.id=captionator.generateID()}var enabledDefaultTrack=false;[].slice.call(videoElement.querySelectorAll("cantemoTrack"),0).forEach(function(trackElement){var sources=null;if(trackElement.querySelectorAll("source").length>0){sources=trackElement.querySelectorAll("source")}else{sources=trackElement.getAttribute("src")}var trackObject=videoElement.addCantemoTextTrack(trackElement.getAttribute("id")||captionator.generateID(),trackElement.getAttribute("kind"),trackElement.getAttribute("label"),trackElement.getAttribute("srclang").split("-")[0],sources,trackElement.getAttribute("type"),trackElement.hasAttribute("default"));trackElement.track=trackObject;trackObject.trackNode=trackElement;trackObject.videoNode=videoElement;trackList.push(trackObject);var trackEnabled=false;if((trackObject.kind==="subtitles"||trackObject.kind==="captions")&&(defaultLanguage===trackObject.language&&options.enableCaptionsByDefault)){if(!trackList.filter(function(trackObject){if((trackObject.kind==="captions"||trackObject.kind==="subtitles")&&defaultLanguage===trackObject.language&&trackObject.mode===captionator.TextTrack.SHOWING){return true}else{return false}}).length){trackEnabled=true}}if(trackObject.kind==="chapters"&&defaultLanguage===trackObject.language){if(!trackList.filter(function(trackObject){if(trackObject.kind==="chapters"&&trackObject.mode===captionator.TextTrack.SHOWING){return true}else{return false}}).length){trackEnabled=true}}if(trackObject.kind==="descriptions"&&options.enableDescriptionsByDefault===true&&defaultLanguage===trackObject.language){if(!trackList.filter(function(trackObject){if(trackObject.kind==="descriptions"&&trackObject.mode===captionator.TextTrack.SHOWING){return true}else{return false}}).length){trackEnabled=true}}if(trackEnabled===true){trackList.forEach(function(trackObject){if(trackObject.trackNode.hasAttribute("default")&&trackObject.mode===captionator.TextTrack.SHOWING){trackObject.mode=captionator.TextTrack.HIDDEN}})}if(trackElement.hasAttribute("default")){if(!trackList.filter(function(trackObject){if(trackObject.trackNode.hasAttribute("default")&&trackObject.trackNode!==trackElement){return true}else{return false}}).length){trackEnabled=true;trackObject.internalDefault=true}}if(trackEnabled===true){trackObject.mode=captionator.TextTrack.SHOWING}});videoElement.addEventListener("timeupdate",function(eventData){var videoElement=eventData.target;try{videoElement.cantemoTextTracks.forEach(function(track){track.activeCues.refreshCues.apply(track.activeCues)})}catch(error){}if(options.renderer instanceof Function){options.renderer.call(captionator,videoElement)}else{captionator.rebuildCaptions(videoElement)}},false);window.addEventListener("resize",function(eventData){videoElement._captionator_dirtyBit=true;captionator.rebuildCaptions(videoElement)},false);if(options.enableHighResolution===true){window.setInterval(function captionatorHighResProcessor(){try{videoElement.cantemoTextTracks.forEach(function(track){track.activeCues.refreshCues.apply(track.activeCues)})}catch(error){}if(options.renderer instanceof Function){options.renderer.call(captionator,videoElement)}else{captionator.rebuildCaptions(videoElement)}},20)}}return videoElement};captionator.getNodeMetrics=function(DOMNode){var nodeComputedStyle=window.getComputedStyle(DOMNode,null);var offsetObject=DOMNode;var offsetTop=DOMNode.offsetTop,offsetLeft=DOMNode.offsetLeft;var width=DOMNode,height=0;var controlHeight=0;width=parseInt(nodeComputedStyle.getPropertyValue("width"),10);height=parseInt(nodeComputedStyle.getPropertyValue("height"),10);while(!!(offsetObject=offsetObject.offsetParent)){offsetTop+=offsetObject.offsetTop;offsetLeft+=offsetObject.offsetLeft}if(DOMNode.hasAttribute("controls")){var UA=navigator.userAgent.toLowerCase();if(UA.indexOf("chrome")!==-1){controlHeight=32}else if(UA.indexOf("opera")!==-1){controlHeight=25}else if(UA.indexOf("firefox")!==-1){controlHeight=28}else if(UA.indexOf("ie 9")!==-1||UA.indexOf("ipad")!==-1){controlHeight=44}else if(UA.indexOf("safari")!==-1){controlHeight=25}}else if(DOMNode._captionatorOptions){var tmpCaptionatorOptions=DOMNode._captionatorOptions;if(tmpCaptionatorOptions.controlHeight){controlHeight=parseInt(tmpCaptionatorOptions.controlHeight,10)}}return{left:offsetLeft,top:offsetTop,width:width,height:height,controlHeight:controlHeight}};captionator.applyStyles=function(StyleNode,styleObject){for(var styleName in styleObject){if({}.hasOwnProperty.call(styleObject,styleName)){StyleNode.style[styleName]=styleObject[styleName]}}};captionator.checkDirection=function(text){var ltrChars="A-Za-zÀ-ÖØ-öø-ʸ̀-֐ࠀ-῿"+"Ⰰ-﬜﷾-﹯﻽-￿",rtlChars="֑-߿יִ-﷽ﹰ-ﻼ",ltrDirCheckRe=new RegExp("^[^"+rtlChars+"]*["+ltrChars+"]"),rtlDirCheckRe=new RegExp("^[^"+ltrChars+"]*["+rtlChars+"]");return!!rtlDirCheckRe.test(text)?"rtl":!!ltrDirCheckRe.test(text)?"ltr":""};captionator.styleCue=function(DOMNode,cueObject,videoElement){var cueX=0,cueY=0,cueWidth=0,cueHeight=0,cueSize,cueAlignment,cuePaddingLR=0,cuePaddingTB=0;var baseFontSize,basePixelFontSize,baseLineHeight,tmpHeightExclusions;var videoHeightInLines,videoWidthInLines,pixelLineHeight,verticalPixelLineHeight,charactersPerLine=0,characterCount=0;var characters=0,lineCount=0,finalLineCharacterCount=0,finalLineCharacterHeight=0,currentLine=0;var characterX,characterY,characterPosition=0;var options=videoElement._captionatorOptions||{};var videoMetrics;var maxCueSize=100,internalTextPosition=50,textBoundingBoxWidth=0,textBoundingBoxPercentage=0,autoSize=true;var plainCueText="",plainCueTextContainer;var cueLanguage=cueObject.track.language;var spanify=function(DOMNode){if(DOMNode.spanified)return DOMNode.characterCount;var stringHasLength=function(textString){return!!textString.length};var spanCode="<span class='captionator-cue-character'>";var nodeIndex,currentNode,currentNodeValue,replacementFragment,characterCount=0;var styleSpan=function(span){characterCount++;captionator.applyStyles(span,{display:"block",lineHeight:"auto",height:basePixelFontSize+"px",width:verticalPixelLineHeight+"px",textAlign:"center"
})};for(nodeIndex in DOMNode.childNodes){if(DOMNode.childNodes.hasOwnProperty(nodeIndex)&&!DOMNode.childNodes[nodeIndex].nospan){currentNode=DOMNode.childNodes[nodeIndex];if(currentNode.nodeType===3){replacementFragment=document.createDocumentFragment();currentNodeValue=currentNode.nodeValue;replacementFragment.appendChild(document.createElement("span"));replacementFragment.childNodes[0].innerHTML=spanCode+currentNodeValue.split(/(.)/).filter(stringHasLength).join("</span>"+spanCode)+"</span>";[].slice.call(replacementFragment.querySelectorAll("span.captionator-cue-character"),0).forEach(styleSpan);currentNode.parentNode.replaceChild(replacementFragment,currentNode)}else if(DOMNode.childNodes[nodeIndex].nodeType===1){characterCount+=spanify(DOMNode.childNodes[nodeIndex])}}}DOMNode.characterCount=characterCount;DOMNode.spanified=true;return characterCount};videoMetrics=captionator.getNodeMetrics(videoElement);if(!videoElement._captionator_availableCueArea){videoElement._captionator_availableCueArea={bottom:videoMetrics.height-videoMetrics.controlHeight,right:videoMetrics.width,top:0,left:0,height:videoMetrics.height-videoMetrics.controlHeight,width:videoMetrics.width}}if(cueObject.direction==="horizontal"){captionator.applyStyles(DOMNode,{width:"auto",position:"static",display:"inline-block",padding:"1em"});textBoundingBoxWidth=parseInt(DOMNode.offsetWidth,10);textBoundingBoxPercentage=Math.floor(textBoundingBoxWidth/videoElement._captionator_availableCueArea.width*100);textBoundingBoxPercentage=textBoundingBoxPercentage<=100?textBoundingBoxPercentage:100}baseFontSize=videoMetrics.height*(fontSizeVerticalPercentage/100)/96*72;baseFontSize=baseFontSize>=minimumFontSize?baseFontSize:minimumFontSize;basePixelFontSize=Math.floor(baseFontSize/72*96);baseLineHeight=Math.floor(baseFontSize*lineHeightRatio);baseLineHeight=baseLineHeight>minimumLineHeight?baseLineHeight:minimumLineHeight;pixelLineHeight=Math.ceil(baseLineHeight/72*96);verticalPixelLineHeight=pixelLineHeight;if(pixelLineHeight*Math.floor(videoMetrics.height/pixelLineHeight)<videoMetrics.height){pixelLineHeight=Math.floor(videoMetrics.height/Math.floor(videoMetrics.height/pixelLineHeight));baseLineHeight=Math.ceil(pixelLineHeight/96*72)}if(pixelLineHeight*Math.floor(videoMetrics.width/pixelLineHeight)<videoMetrics.width){verticalPixelLineHeight=Math.ceil(videoMetrics.width/Math.floor(videoMetrics.width/pixelLineHeight))}videoHeightInLines=Math.floor(videoElement._captionator_availableCueArea.height/pixelLineHeight);videoWidthInLines=Math.floor(videoElement._captionator_availableCueArea.width/verticalPixelLineHeight);if(parseFloat(String(cueObject.size).replace(/[^\d\.]/gi,""))===0){if(options.sizeCuesByTextBoundingBox===true){cueSize=textBoundingBoxPercentage}else{cueSize=100;autoSize=false}}else{autoSize=false;cueSize=parseFloat(String(cueObject.size).replace(/[^\d\.]/gi,""));cueSize=cueSize<=100?cueSize:100}cuePaddingLR=cueObject.direction==="horizontal"?Math.floor(videoMetrics.width*.01):0;cuePaddingTB=cueObject.direction==="horizontal"?0:Math.floor(videoMetrics.height*.01);if(cueObject.linePosition==="auto"){cueObject.linePosition=cueObject.direction==="horizontal"?videoHeightInLines:videoWidthInLines}else if(String(cueObject.linePosition).match(/\%/)){cueObject.snapToLines=false;cueObject.linePosition=parseFloat(String(cueObject.linePosition).replace(/\%/gi,""))}if(cueObject.direction==="horizontal"){cueHeight=pixelLineHeight;if(cueObject.textPosition!=="auto"&&autoSize){internalTextPosition=parseFloat(String(cueObject.textPosition).replace(/[^\d\.]/gi,""));if(cueSize-internalTextPosition>textBoundingBoxPercentage){cueSize-=internalTextPosition}else{cueSize=textBoundingBoxPercentage}}if(cueObject.snapToLines===true){cueWidth=videoElement._captionator_availableCueArea.width*(cueSize/100)}else{cueWidth=videoMetrics.width*(cueSize/100)}if(cueObject.textPosition==="auto"){cueX=(videoElement._captionator_availableCueArea.right-cueWidth)/2+videoElement._captionator_availableCueArea.left}else{internalTextPosition=parseFloat(String(cueObject.textPosition).replace(/[^\d\.]/gi,""));cueX=(videoElement._captionator_availableCueArea.right-cueWidth)*(internalTextPosition/100)+videoElement._captionator_availableCueArea.left}if(cueObject.snapToLines===true){cueY=(videoHeightInLines-1)*pixelLineHeight+videoElement._captionator_availableCueArea.top}else{tmpHeightExclusions=videoMetrics.controlHeight+pixelLineHeight+cuePaddingTB*2;cueY=(videoMetrics.height-tmpHeightExclusions)*(cueObject.linePosition/100)}}else{cueY=videoElement._captionator_availableCueArea.top;cueX=videoElement._captionator_availableCueArea.right-verticalPixelLineHeight;cueWidth=verticalPixelLineHeight;cueHeight=videoElement._captionator_availableCueArea.height*(cueSize/100);characterCount=spanify(DOMNode);characters=[].slice.call(DOMNode.querySelectorAll("span.captionator-cue-character"),0);charactersPerLine=Math.floor((cueHeight-cuePaddingTB*2)/basePixelFontSize);cueWidth=Math.ceil(characterCount/charactersPerLine)*verticalPixelLineHeight;lineCount=Math.ceil(characterCount/charactersPerLine);finalLineCharacterCount=characterCount-charactersPerLine*(lineCount-1);finalLineCharacterHeight=finalLineCharacterCount*basePixelFontSize;if(cueObject.snapToLines===true){cueX=cueObject.direction==="vertical-lr"?videoElement._captionator_availableCueArea.left:videoElement._captionator_availableCueArea.right-cueWidth}else{var temporaryWidthExclusions=cueWidth+cuePaddingLR*2;if(cueObject.direction==="vertical-lr"){cueX=(videoMetrics.width-temporaryWidthExclusions)*(cueObject.linePosition/100)}else{cueX=videoMetrics.width-temporaryWidthExclusions-(videoMetrics.width-temporaryWidthExclusions)*(cueObject.linePosition/100)}}if(cueObject.textPosition==="auto"){cueY=(videoElement._captionator_availableCueArea.bottom-cueHeight)/2+videoElement._captionator_availableCueArea.top}else{cueObject.textPosition=parseFloat(String(cueObject.textPosition).replace(/[^\d\.]/gi,""));cueY=(videoElement._captionator_availableCueArea.bottom-cueHeight)*(cueObject.textPosition/100)+videoElement._captionator_availableCueArea.top}currentLine=0;characterPosition=0;characterX=0;characterY=0;characters.forEach(function(characterSpan,characterCount){if(cueObject.direction==="vertical-lr"){characterX=verticalPixelLineHeight*currentLine}else{characterX=cueWidth-verticalPixelLineHeight*(currentLine+1)}if(cueObject.alignment==="start"||cueObject.alignment!=="start"&&currentLine<lineCount-1){characterY=characterPosition*basePixelFontSize+cuePaddingTB}else if(cueObject.alignment==="end"){characterY=characterPosition*basePixelFontSize-basePixelFontSize+(cueHeight+cuePaddingTB*2-finalLineCharacterHeight)}else if(cueObject.alignment==="middle"){characterY=(cueHeight-cuePaddingTB*2-finalLineCharacterHeight)/2+characterPosition*basePixelFontSize}characterSpan.setAttribute("aria-hidden","true");captionator.applyStyles(characterSpan,{position:"absolute",top:characterY+"px",left:characterX+"px"});if(characterPosition>=charactersPerLine-1){characterPosition=0;currentLine++}else{characterPosition++}});if(!DOMNode.accessified){plainCueText=cueObject.text.getPlain(videoElement.currentTime);plainCueTextContainer=document.createElement("div");plainCueTextContainer.innerHTML=plainCueText;plainCueTextContainer.nospan=true;DOMNode.appendChild(plainCueTextContainer);DOMNode.accessified=true;captionator.applyStyles(plainCueTextContainer,{position:"absolute",overflow:"hidden",width:"1px",height:"1px",opacity:"0",textIndent:"-999em"})}}if(cueObject.direction==="horizontal"){if(captionator.checkDirection(String(cueObject.text))==="rtl"){cueAlignment={start:"right",middle:"center",end:"left"}[cueObject.alignment]}else{cueAlignment={start:"left",middle:"center",end:"right"}[cueObject.alignment]}}captionator.applyStyles(DOMNode,{position:"absolute",overflow:"hidden",width:cueWidth+"px",height:cueHeight+"px",top:cueY+"px",left:cueX+"px",padding:cuePaddingTB+"px "+cuePaddingLR+"px",textAlign:cueAlignment,backgroundColor:"rgba("+cueBackgroundColour.join(",")+")",direction:captionator.checkDirection(String(cueObject.text)),lineHeight:baseLineHeight+"pt",boxSizing:"border-box"});if(cueObject.direction==="vertical"||cueObject.direction==="vertical-lr"){if(cueX-videoElement._captionator_availableCueArea.left-videoElement._captionator_availableCueArea.left>=videoElement._captionator_availableCueArea.right-(cueX+cueWidth)){videoElement._captionator_availableCueArea.right=cueX}else{videoElement._captionator_availableCueArea.left=cueX+cueWidth}videoElement._captionator_availableCueArea.width=videoElement._captionator_availableCueArea.right-videoElement._captionator_availableCueArea.left}else{if(DOMNode.scrollHeight>DOMNode.offsetHeight*1.2){if(cueObject.snapToLines){var upwardAjustmentInLines=0;while(DOMNode.scrollHeight>DOMNode.offsetHeight*1.2){cueHeight+=pixelLineHeight;DOMNode.style.height=cueHeight+"px";upwardAjustmentInLines++}cueY=cueY-upwardAjustmentInLines*pixelLineHeight;DOMNode.style.top=cueY+"px"}else{var upwardAjustment=DOMNode.scrollHeight-cueHeight;cueHeight=DOMNode.scrollHeight+cuePaddingTB;tmpHeightExclusions=videoMetrics.controlHeight+cueHeight+cuePaddingTB*2;cueY=(videoMetrics.height-tmpHeightExclusions)*(cueObject.linePosition/100);DOMNode.style.height=cueHeight+"px";DOMNode.style.top=cueY+"px"}}if(cueY-videoElement._captionator_availableCueArea.top-videoElement._captionator_availableCueArea.top>=videoElement._captionator_availableCueArea.bottom-(cueY+cueHeight)&&videoElement._captionator_availableCueArea.bottom>cueY){videoElement._captionator_availableCueArea.bottom=cueY}else{if(videoElement._captionator_availableCueArea.top<cueY+cueHeight){videoElement._captionator_availableCueArea.top=cueY+cueHeight}}videoElement._captionator_availableCueArea.height=videoElement._captionator_availableCueArea.bottom-videoElement._captionator_availableCueArea.top}if(options.debugMode){var debugCanvas,debugContext;var generateDebugCanvas=function(){if(!debugCanvas){if(videoElement._captionatorDebugCanvas){debugCanvas=videoElement._captionatorDebugCanvas;debugContext=videoElement._captionatorDebugContext}else{debugCanvas=document.createElement("canvas");debugCanvas.setAttribute("width",videoMetrics.width);debugCanvas.setAttribute("height",videoMetrics.height-videoMetrics.controlHeight);document.body.appendChild(debugCanvas);captionator.applyStyles(debugCanvas,{position:"absolute",top:videoMetrics.top+"px",left:videoMetrics.left+"px",width:videoMetrics.width+"px",height:videoMetrics.height-videoMetrics.controlHeight+"px",zIndex:3e3});debugContext=debugCanvas.getContext("2d");videoElement._captionatorDebugCanvas=debugCanvas;videoElement._captionatorDebugContext=debugContext}}};var clearDebugCanvas=function(){generateDebugCanvas();debugCanvas.setAttribute("width",videoMetrics.width)};var drawLines=function(){var lineIndex;generateDebugCanvas();debugContext.strokeStyle="rgba(255,0,0,0.5)";debugContext.lineWidth=1;debugContext.beginPath();for(lineIndex=0;lineIndex<videoHeightInLines;lineIndex++){debugContext.moveTo(.5,lineIndex*pixelLineHeight+.5);debugContext.lineTo(videoMetrics.width,lineIndex*pixelLineHeight+.5)}debugContext.closePath();debugContext.stroke();debugContext.beginPath();debugContext.strokeStyle="rgba(0,255,0,0.5)";for(lineIndex=videoWidthInLines;lineIndex>=0;lineIndex--){debugContext.moveTo(videoMetrics.width-lineIndex*verticalPixelLineHeight-.5,-.5);debugContext.lineTo(videoMetrics.width-lineIndex*verticalPixelLineHeight-.5,videoMetrics.height)}debugContext.closePath();debugContext.stroke();debugContext.beginPath();debugContext.strokeStyle="rgba(255,255,0,0.5)";for(lineIndex=0;lineIndex<=videoWidthInLines;lineIndex++){debugContext.moveTo(lineIndex*verticalPixelLineHeight+.5,-.5);debugContext.lineTo(lineIndex*verticalPixelLineHeight+.5,videoMetrics.height)}debugContext.stroke();videoElement.linesDrawn=true};var drawAvailableArea=function(){generateDebugCanvas();debugContext.fillStyle="rgba(100,100,255,0.5)";debugContext.fillRect(videoElement._captionator_availableCueArea.left,videoElement._captionator_availableCueArea.top,videoElement._captionator_availableCueArea.right,videoElement._captionator_availableCueArea.bottom);debugContext.stroke()};clearDebugCanvas();drawAvailableArea();drawLines()}};captionator.styleCueCanvas=function(videoElement){var baseFontSize,baseLineHeight;var containerObject,descriptionContainerObject;var containerID,descriptionContainerID;var options=videoElement._captionatorOptions instanceof Object?videoElement._captionatorOptions:{};if(!(videoElement instanceof HTMLVideoElement)){throw new Error("Cannot style a cue canvas for a non-video node!")}if(videoElement._containerObject){containerObject=videoElement._containerObject;containerID=containerObject.id}if(videoElement._descriptionContainerObject){descriptionContainerObject=videoElement._descriptionContainerObject;descriptionContainerID=descriptionContainerObject.id}if(!descriptionContainerObject){descriptionContainerObject=document.createElement("div");descriptionContainerObject.className="captionator-cue-descriptive-container";descriptionContainerID=captionator.generateID();descriptionContainerObject.id=descriptionContainerID;videoElement._descriptionContainerObject=descriptionContainerObject;descriptionContainerObject.setAttribute("aria-live","polite");descriptionContainerObject.setAttribute("aria-atomic","true");descriptionContainerObject.setAttribute("role","region");document.body.appendChild(descriptionContainerObject);captionator.applyStyles(descriptionContainerObject,{position:"absolute",overflow:"hidden",width:"1px",height:"1px",opacity:"0",textIndent:"-999em"})}else if(!descriptionContainerObject.parentNode){document.body.appendChild(descriptionContainerObject)}if(!containerObject){containerObject=document.createElement("div");containerObject.className="captionator-cue-canvas";containerID=captionator.generateID();containerObject.id=containerID;if(options.appendCueCanvasTo){var canvasParentNode=null;if(options.appendCueCanvasTo instanceof HTMLElement){canvasParentNode=options.appendCueCanvasTo}else if(typeof options.appendCueCanvasTo==="string"){try{var canvasSearchResult=document.querySelectorAll(options.appendCueCanvasTo);if(canvasSearchResult.length>0){canvasParentNode=canvasSearchResult[0]}else{throw null}}catch(error){canvasParentNode=document.body;options.appendCueCanvasTo=false}}else{canvasParentNode=document.body;options.appendCueCanvasTo=false}canvasParentNode.appendChild(containerObject)}else{document.body.appendChild(containerObject)}videoElement._containerObject=containerObject}else if(!containerObject.parentNode){document.body.appendChild(containerObject)}var videoMetrics=captionator.getNodeMetrics(videoElement);baseFontSize=videoMetrics.height*(fontSizeVerticalPercentage/100)/96*72;baseFontSize=baseFontSize>=minimumFontSize?baseFontSize:minimumFontSize;baseLineHeight=Math.floor(baseFontSize*lineHeightRatio);baseLineHeight=baseLineHeight>minimumLineHeight?baseLineHeight:minimumLineHeight;captionator.applyStyles(containerObject,{position:"absolute",overflow:"hidden",zIndex:100,height:videoMetrics.height-videoMetrics.controlHeight+"px",width:videoMetrics.width+"px",top:(options.appendCueCanvasTo?0:videoMetrics.top)+"px",left:(options.appendCueCanvasTo?0:videoMetrics.left)+"px",color:"white",fontFamily:"Verdana, Helvetica, Arial, sans-serif",fontSize:baseFontSize+"pt",lineHeight:baseLineHeight+"pt",boxSizing:"border-box"})};captionator.createDOMException=function(code,message,name){try{document.querySelectorAll("div/[]")}catch(Error){var CustomDOMException=function CustomDOMException(code,message,name){this.code=code;this.message=message;this.name=name};CustomDOMException.prototype=Error;return new CustomDOMException(code,message,name)}};captionator.compareArray=function compareArray(array1,array2){if(!(array1 instanceof Array)||!(array2 instanceof Array)){return false}if(array1.length!==array2.length){return false}for(var index in array1){if(array1.hasOwnProperty(index)){if(array1[index]!==array2[index]){return false}}}return true};captionator.generateID=function(stringLength){var idComposite="";stringLength=stringLength?stringLength:10;while(idComposite.length<stringLength){idComposite+=String.fromCharCode(65+Math.floor(Math.random()*26))}return"captionator"+idComposite}})();
